<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile">
<h:body>
	<ui:composition template="/layouts/basic.xhtml">
		<ui:define name="title">AsyncUiInvoker</ui:define>
		<ui:define name="content">
			<h3>Async backend call</h3>
			
			<h:outputScript library="ivy-webcontent" name="js/ivy.js" target="head" />
			<h:outputScript library="ivy-dialog" name="serviceClient.js" target="head" />
			<script type="text/javascript">
				var resource = new IvyUri().rest()+"/batch/async";
				var client = new ServiceClient(resource);
				
				function show(state)
				{
					var uiResult = document.getElementById("uiResult");
					uiResult.innerHTML = state;
				}
				
				function invokeAsync()
				{
					show("call remote batch");
					client.batch(show);
					show("awaiting response");
				}
			</script>
			
			<h:form id="form">
					<f:facet name="header">
						<p:messages></p:messages>
					</f:facet>
				<h:panelGrid columns="2" border="2">
					
					<p:fieldset style="border:none;">
						Timeout to simulate: <br/>
						<p:knob widgetVar="timeout" max="10" value="3" onchange="alert('update'+timeout)"></p:knob>
					</p:fieldset>
					
					<p:fieldset style="border:none;">
						<p:commandButton value="Call slow service" onclick="invokeAsync(); return false;" />
						<div id="uiResult">
						
						</div>
					</p:fieldset>
					
				</h:panelGrid>
					<br />
				<p:commandButton actionListener="#{logic.close}" value="Close" update="form" icon="ui-icon-check" />
			</h:form>
			
		</ui:define>
	</ui:composition>
</h:body>
</html>