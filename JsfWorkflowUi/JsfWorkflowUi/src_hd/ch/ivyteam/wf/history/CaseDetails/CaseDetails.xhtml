<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"      
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:ic="http://ivyteam.ch/jsf/component"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:pm="http://primefaces.org/mobile"
      xmlns:wc="http://java.sun.com/jsf/composite/wf-component">
 
<ui:composition template="/layouts/Workflow.xhtml">
	<ui:param name="centerHeader" value="#{ivy.cms.co('/navLabels/caseDetails')}" />
	<ui:define name="center">
		<f:event type="preRenderView" listener="#{logic.update()}" />
		<br />
		#{ivy.cms.co('/labels/history/caseDetails/description')}
		<br /><br />
		<h:form id="formCaseDetails">
			<h:panelGrid columns="1">
				<p:toolbar>  
    				<p:toolbarGroup align="left">
    					<p:commandButton id="openDeleteCase" value="#{ivy.cms.co('/labels/history/caseDetails/caseDelete')}" title="#{ivy.cms.co('/labels/history/caseDetails/deleteCaseTooltip')}" icon="wf-ui-icon-delete" onclick="PF('confirmDeleteReset').show();" disabled="#{data.deleteCaseLink}" />
						<p:commandButton id="openAddNoteCase" value="#{ivy.cms.co('/labels/dialogs/addNote/addNote')}" title="#{ivy.cms.co('/labels/common/addNoteTooltip')}" icon="wf-ui-icon-addNote" onclick="PF('addNote').show();" disabled="#{data.addNoteLink}" />
						<p:commandButton id="openPageArchive" value="#{ivy.cms.co('/labels/common/formArchive')}" title="#{ivy.cms.co('/labels/common/showFormArchiveTooltip')}" icon="wf-ui-icon-archive" onclick="PF('formArchive').show();" disabled="#{data.archiveLink}" />
					</p:toolbarGroup>
				</p:toolbar>
			</h:panelGrid>
			<br />
			<h:panelGrid columns="3" rowClasses="alignTop" width="100%">
				<h:column>
					<table id="caseDetailsList" class="detailsList">
						<tr>
							<th>#{ivy.cms.co('/labels/history/caseDetails/caseId')}</th>
							<td>#{data.wfCase.id}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/name')}</th>
							<td>#{data.wfCase.name}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/description')}</th>
							<td>#{data.wfCase.description}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/history/caseDetails/processmodel')}</th>
							<td>#{data.wfCase.processModel.name}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/history/caseDetails/version')}</th>
							<td>#{data.wfCase.processModelVersion}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/state')}</th>
							<td>
								<wc:IconDescription iconName="images/details/caseState/#{data.wfCase.getState().intValue()}.png" iconDescription="#{data.wfCase.state}" />
							</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/creator')}</th>
							<td>
								<wc:MemberDetail member="#{data.wfCase.creatorUser}" />
							</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/start')}</th>
							<td>
								<h:outputText value="#{data.wfCase.startTimestamp}">
									<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
								</h:outputText>
							</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/category')}</th>
							<td>
								<h:outputText value="#{data.wfCase.processCategoryName}" />
   								<h:outputText value=" #{data.wfCase.processCategoryCode}" rendered="#{data.wfCase.processCategoryCode == ''}" />
   								<h:outputText value=" (#{data.wfCase.processCategoryCode})" rendered="#{data.wfCase.processCategoryCode != ''}" /> 
							</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/process')}</th>
							<td>
								<h:outputText value="#{data.wfCase.processName}" />
   								<h:outputText value=" #{data.wfCase.processCode}" rendered="#{data.wfCase.processCode == ''}" />
   								<h:outputText value=" (#{data.wfCase.processCode})" rendered="#{data.wfCase.processCode != ''}" /> 
   							</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/done')}</th>
							<td>
								<h:outputText value="#{data.wfCase.endTimestamp}">
									<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
								</h:outputText>
							</td>
						</tr>
					</table>
				</h:column>
				<p:spacer width="50" />
				<h:column>
					<p:fieldset legend="#{ivy.cms.co('/labels/common/notes')}" toggleable="true" toggleSpeed="500" rendered="#{data.wfCase.hasNotes()}">
						<p:dataList value="#{data.notes}" var="caseNote" itemType="none">
							<f:facet name="header">
					            #{ivy.cms.co('/labels/common/caseNotes')}
					        </f:facet>
							<h:panelGrid columns="3" style="width:100%">
								<p:outputPanel>
			    					<h:outputText value="#{caseNote.creationTimestamp}" style="font-weight:bold;" >
			    						<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
									</h:outputText>
			    					<h:outputText value=" #{caseNote.writterName}:" escape="false" style="font-weight:bold;" />
			    					<br />
			    					<h:outputText value="#{caseNote.message}" escape="false" />
		    					</p:outputPanel>
		    					<p:spacer width="20" />
								<p:commandButton id="openDeleteCaseNote" icon="wf-ui-icon-delete" onclick="PF('confirmDeleteNote').show();" disabled="#{caseNote.writterName != ivy.session.sessionUserName}" >
		    						<f:setPropertyActionListener value="#{caseNote}" target="#{data.note}" />
									<f:setPropertyActionListener value="case" target="#{data.noteFor}" />
		    					</p:commandButton>
							</h:panelGrid>
						</p:dataList>
				    </p:fieldset>
			    </h:column>
			</h:panelGrid>
		</h:form>
		<br /><br />
		<h:outputText value="#{ivy.cms.co('/labels/common/tasks')}" style="font-weight:bold;" />
		<br /><br />
		<h:form id="formTaskList">
   			<p:dataTable id="taskTable" value="#{data.tasks}" var="task" emptyMessage="#{ivy.cms.co('/labels/common/noTasks')}" rowIndexVar="row">
      			<p:column id="absenceStart" style="width:2%">  
           			<f:facet name="header">  
               			#
           			</f:facet>
           			<a href="#{ivy.html.startref('13FE81AF3A82F57F/TaskHistoryDetails.ivp')}?detailTaskId=#{task.id}" id="buttonTaskDetail" title="Details Task [#{task.id}]"><h:graphicImage name="images/actions/task#{task.hasNotes() || task.case.hasNotes() ? 'WithNote' : ''}.png" alt="task detail" /></a>
        		</p:column>
       			<p:column style="width:50px; text-align: center;">
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/taskPrio')}
					</f:facet>
					<h:graphicImage name="images/details/priority/#{task.priority.intValue()}.png" alt="prio" title="Prio #{task.priority}" />
				</p:column>
       			<p:column style="width:50px; text-align: center;">
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/taskState')}
					</f:facet>
					<h:graphicImage name="images/details/state/#{task.state.intValue()}.png" alt="#{task.state}" title="#{ivy.cms.co('/labels/common/state')} #{task.state}" />
				</p:column>
       			<p:column>
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/task')}
					</f:facet>
					<a href="#{ivy.html.startref('13FE81AF3A82F57F/TaskHistoryDetails.ivp')}?detailTaskId=#{task.id}" title="Details Task [#{task.id}]">#{task.name}</a>
				</p:column>
       			<p:column>
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/responsible')}
					</f:facet>
					<wc:MemberDetail member="#{task.activator}" />
				</p:column>
       			<p:column>
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/taskStart')}
					</f:facet>
					<h:outputText value="#{task.startTimestamp}">  
			            <f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
					</h:outputText>
				</p:column>
				<p:column>  
           			<f:facet name="header">  
               			#{ivy.cms.co('/labels/common/done')}  
           			</f:facet>
           			<h:outputText value="#{task.endTimestamp.getYear().toString() == 1 ? '' : task.endTimestamp}">
						<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
					</h:outputText>
       			</p:column>
   			</p:dataTable>
		</h:form>
		<ui:include src="/includes/dialogs/AddNote.xhtml" />
		<ui:include src="/includes/dialogs/ConfirmDeleteNote.xhtml" />
		<ui:include src="/includes/dialogs/ConfirmDeleteReset.xhtml" >
			<ui:param name="headerConfirm" value="#{ivy.cms.co('/labels/history/caseDetails/caseDelete')}" />
			<ui:param name="description" value="#{ivy.cms.co('/labels/dialogs/confirmDialog/deleteCase')}" />
		</ui:include>
		<ui:include src="/includes/dialogs/Archive.xhtml" />
   	</ui:define>
</ui:composition>
</html>