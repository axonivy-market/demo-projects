<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile"
	xmlns:wc="http://java.sun.com/jsf/composite/wf-component">

<ui:composition template="/layouts/Workflow.xhtml">
	<ui:define name="center">
		<f:event type="preRenderView" listener="#{logic.update()}" />
		<h2>
			<span class="fa fa-folder-open-o" />
			#{ivy.cms.co('/navLabels/caseDetails')}
		</h2>
		<br />
		#{ivy.cms.co('/labels/history/caseDetails/description')}
		<br />
		<br />
		<h:form id="formCaseDetails">
			<h:panelGrid columns="1">
				<p:toolbar styleClass="ivy-toolbar">
					<p:toolbarGroup align="left">
						<p:commandButton id="openDeleteCase"
							value="#{ivy.cms.co('/labels/history/caseDetails/caseDelete')}"
							title="#{ivy.cms.co('/labels/history/caseDetails/deleteCaseTooltip')}"
							icon="fa fa-trash" onclick="PF('confirmDeleteReset').show();"
							disabled="#{data.deleteCaseLink}" />
						<p:commandButton id="openAddNoteCase"
							value="#{ivy.cms.co('/labels/dialogs/addNote/addNote')}"
							title="#{ivy.cms.co('/labels/common/addNoteTooltip')}"
							icon="fa fa-pencil-square-o" onclick="PF('addNote').show();"
							disabled="#{data.addNoteLink}" />
						<p:commandButton id="openPageArchive"
							value="#{ivy.cms.co('/labels/common/formArchive')}"
							title="#{ivy.cms.co('/labels/common/showFormArchiveTooltip')}"
							icon="fa fa-archive" onclick="PF('formArchive').show();"
							disabled="#{data.archiveLink}" />
					</p:toolbarGroup>
				</p:toolbar>
			</h:panelGrid>
			<br />
			<h:panelGrid columns="3" rowClasses="alignTop" style="width:100%">
				<h:column>
					<table id="caseDetailsList" class="detailsList">
						<tr>
							<th>#{ivy.cms.co('/labels/history/caseDetails/caseId')}</th>
							<td>#{data.wfCase.id}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/name')}</th>
							<td>#{data.wfCase.name}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/description')}</th>
							<td>#{data.wfCase.description}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/state')}</th>
							<td><wc:CaseStateIconAndText state="#{data.wfCase.state}"
									withText="true" /></td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/creator')}</th>
							<td><wc:MemberDetail member="#{data.wfCase.creatorUser}" />
							</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/start')}</th>
							<td><h:outputText value="#{data.wfCase.startTimestamp}">
									<f:convertDateTime type="both" dateStyle="short"
										timeStyle="short" />
								</h:outputText></td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/category')}</th>
							<td><h:outputText value="#{data.wfCase.processCategoryName}" />
								<h:outputText value=" #{data.wfCase.processCategoryCode}"
									rendered="#{data.wfCase.processCategoryCode == ''}" /> <h:outputText
									value=" (#{data.wfCase.processCategoryCode})"
									rendered="#{data.wfCase.processCategoryCode != ''}" /></td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/process')}</th>
							<td><h:outputText value="#{data.wfCase.processName}" /> <h:outputText
									value=" #{data.wfCase.processCode}"
									rendered="#{data.wfCase.processCode == ''}" /> <h:outputText
									value=" (#{data.wfCase.processCode})"
									rendered="#{data.wfCase.processCode != ''}" /></td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/common/done')}</th>
							<td><h:outputText value="#{data.wfCase.endTimestamp}">
									<f:convertDateTime type="both" dateStyle="short"
										timeStyle="short" />
								</h:outputText></td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/history/caseDetails/processmodel')}</th>
							<td>#{data.wfCase.processModel.name}</td>
						</tr>
						<tr>
							<th>#{ivy.cms.co('/labels/history/caseDetails/version')}</th>
							<td>#{data.wfCase.processModelVersion}</td>
						</tr>
					</table>
				</h:column>
				<p:spacer width="100" />
				<h:column>
					<p:fieldset legend="#{ivy.cms.co('/labels/common/notes')}"
						toggleable="true" toggleSpeed="500"
						rendered="#{data.wfCase.hasNotes()}">
						<p:dataList value="#{data.notes}" var="caseNote" itemType="none">
							<f:facet name="header">
					            #{ivy.cms.co('/labels/common/caseNotes')}
					        </f:facet>
							<h:panelGrid columns="3" style="width:90%">
								<p:outputPanel style="width:300px">
									<h:outputText value="#{caseNote.creationTimestamp}"
										style="font-weight:bold;">
										<f:convertDateTime type="both" dateStyle="short"
											timeStyle="short" />
									</h:outputText>
									<h:outputText value=" #{caseNote.writterName}:" escape="false"
										style="font-weight:bold;" />
									<br />
									<h:outputText value="#{caseNote.message}" escape="false" />
								</p:outputPanel>
								<p:spacer width="20" />
								<p:commandButton
									title="#{ivy.cms.co('/labels/dialogs/confirmDialog/deleteNoteTitle')}"
									id="openDeleteCaseNote" icon="fa fa-trash"
									style="background-color:#ffffff; border:0px; width:20px;"
									onclick="PF('confirmDeleteNote').show();"
									disabled="#{caseNote.writterName != ivy.session.sessionUserName}">
									<f:setPropertyActionListener value="#{caseNote}"
										target="#{data.note}" />
									<f:setPropertyActionListener value="case"
										target="#{data.noteFor}" />
								</p:commandButton>
							</h:panelGrid>
						</p:dataList>
					</p:fieldset>
				</h:column>
			</h:panelGrid>
		</h:form>
		<br />
		<br />
		<h:form id="formTaskList">
			<h4>
				<h:outputText value="#{ivy.cms.co('/labels/common/tasks')}"
					style="font-weight:bold;" />
			</h4>
			<p:dataTable id="taskTable" value="#{data.tasks}" var="task"
				emptyMessage="#{ivy.cms.co('/labels/common/noTasks')}"
				rowIndexVar="row">
				<p:column id="absenceStart" style="width:12px">
					<f:facet name="header">  
               			#
           			</f:facet>
					<a
						href="#{ivy.html.startref('13FE81AF3A82F57F/TaskHistoryDetails.ivp')}?detailTaskId=#{task.id}"
						id="buttonTaskDetail" title="Details Task [#{task.id}]"> <span
						class="fa fa-file-text-o" />
					</a>
				</p:column>
				<p:column style="width:40px; text-align: center;">
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/taskPrio')}
					</f:facet>
					<wc:PriorityIcon priority="#{task.priority}" />
				</p:column>
				<p:column style="width:40px; text-align: center;">
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/taskState')}
					</f:facet>
					<wc:TaskStateIcon state="#{task.state}" />
				</p:column>
				<p:column>
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/task')}
					</f:facet>
					<a
						href="#{ivy.html.startref('13FE81AF3A82F57F/TaskHistoryDetails.ivp')}?detailTaskId=#{task.id}"
						title="Details Task [#{task.id}]"> #{task.name} </a>
				</p:column>
				<p:column>
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/responsible')}
					</f:facet>
					<wc:MemberDetail member="#{task.activator}" />
				</p:column>
				<p:column>
					<f:facet name="header">
						#{ivy.cms.co('/labels/common/taskStart')}
					</f:facet>
					<h:outputText value="#{task.startTimestamp}">
						<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
					</h:outputText>
				</p:column>
				<p:column>
					<f:facet name="header">  
               			#{ivy.cms.co('/labels/common/done')}  
           			</f:facet>
					<h:outputText
						value="#{task.endTimestamp.getYear().toString() == 1 ? '' : task.endTimestamp}">
						<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
					</h:outputText>
				</p:column>
				<f:facet name="footer">

					<p:selectBooleanCheckbox value="#{data.showSystemTasks}"
						id="showSystemTasks"
						style="float: left; margin-left: 6px; margin-top: -2px;">
						<p:ajax update="taskTable" listener="#{logic.update}" />
					</p:selectBooleanCheckbox>
					<h:outputLabel for="showSystemTasks"
						style="float: left; color: #656565;">#{ivy.cms.co("/labels/history/caseDetails/showSYSTEMtasks")}</h:outputLabel>
					<h:outputLabel />
				</f:facet>
			</p:dataTable>

		</h:form>
		<ui:include src="/includes/dialogs/AddNote.xhtml" />
		<ui:include src="/includes/dialogs/ConfirmDeleteNote.xhtml" />
		<ui:include src="/includes/dialogs/ConfirmDeleteReset.xhtml">
			<ui:param name="headerConfirm"
				value="#{ivy.cms.co('/labels/history/caseDetails/caseDelete')}" />
			<ui:param name="description"
				value="#{ivy.cms.co('/labels/dialogs/confirmDialog/deleteCase')}" />
		</ui:include>
		<ui:include src="/includes/dialogs/Archive.xhtml" />
	</ui:define>
</ui:composition>
</html>