<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"      
      xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:ic="http://ivyteam.ch/jsf/component"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:pm="http://primefaces.org/mobile">

<ui:composition template="/templates/Layout.xhtml">
	<ui:param name="centerHeader" value="#{ivy.cms.co('/navLabels/absence')}" />
	<ui:define name="center">
		<f:event type="preRenderView" listener="#{logic.update()}" />
		<br />
		#{ivy.cms.co('/labels/settings/absence/description')}
		<br /><br />
		<p:outputPanel id="userAbsentOutput">
			<c:if test="#{ivy.wf.securityContext.currentSession.absent}">
				<h:outputText value="#{ivy.cms.co('/labels/settings/substitute/currentState')}: #{ivy.cms.co('/labels/settings/absence/currentlyAbsent')}" style="font-weight:bold" />
				<br /><br />
			</c:if>
		</p:outputPanel>
		<h:form id="formAddButton">
			<p:commandButton id="addAbsence" update=":dialogAddAbsence" icon="wf-ui-icon-add" value="#{ivy.cms.co('/labels/settings/absence/addAbsence')}" title="#{ivy.cms.co('/labels/settings/absence/addAbsenceTooltip')}" oncomplete="PF('addAbsence').show();">
				<f:setPropertyActionListener value="add" target="#{data.option}" />
           	</p:commandButton>
		</h:form>
		<br />
		<h:form id="formAbsence">
   			<p:dataTable id="tableAbsence" value="#{data.absences}" var="absence" emptyMessage="#{ivy.cms.co('/labels/common/noAbsences')}">
       			<p:column id="absenceStart" sortBy="startTimestamp" style="width: 150px;">
           			<f:facet name="header">
              			#{ivy.cms.co('/labels/settings/absence/absenceStart')}
           			</f:facet>
                 	<h:outputText value="#{absence.startTimestamp}">
						<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
					</h:outputText>
      			</p:column>
       			<p:column sortBy="#{absence.stopTimestamp}" style="width: 150px; ">
           			<f:facet name="header">
               			#{ivy.cms.co('/labels/settings/absence/absenceStop')}
           			</f:facet>
                   	<h:outputText value="#{absence.stopTimestamp}">
						<f:convertDateTime type="both" dateStyle="short" timeStyle="short" />
					</h:outputText>
       			</p:column>
       			<p:column>
           			<f:facet name="header">
               			#{ivy.cms.co('/labels/common/description')}
           			</f:facet>
           			#{absence.description}
       			</p:column>
       			<p:column style="width: 80px; text-align: center;">
           			<f:facet name="header">
               			#{ivy.cms.co('/labels/settings/absence/absenceControls')}
           			</f:facet>
                    <p:commandButton id="editButton" update=":dialogEditAbsence" oncomplete="PF('editAbsence').show();" icon="wf-ui-icon-edit" value="#{ivy.cms.co('/labels/common/edit')}">
               			<f:setPropertyActionListener value="#{absence.description}" target="#{data.absenceDescription}" />
               			<f:setPropertyActionListener value="#{absence.startTimestamp}" target="#{data.startDateTime}" />
               			<f:setPropertyActionListener value="#{absence.stopTimestamp}" target="#{data.endDateTime}" />
               			<f:setPropertyActionListener value="#{absence.id}" target="#{data.deleteId}" />
               			<f:setPropertyActionListener value="edit" target="#{data.option}" />
           			</p:commandButton>
           			<p:commandButton id="removeButton" actionListener="#{logic.removeAbsence(absence.id)}" update=":formAbsence" icon="wf-ui-icon-delete" value="#{ivy.cms.co('/labels/common/delete')}" ajax="false" />
        		</p:column>
   			</p:dataTable>
		</h:form>
		
		<p:dialog id="dialogAddAbsence" header="#{ivy.cms.co('/labels/settings/absence/addAbsence')}" widgetVar="addAbsence" modal="true" appendTo="@(body)" visible="#{data.add}">
   			<h:form id="formAddAbsence">
				<ui:include src="AbsenceDialog.xhtml" />
				<h:panelGrid style="width:100%; text-align: right;">
 					<p:outputPanel>
 						<p:commandButton id="saveNewAbsence" value="#{ivy.cms.co('/labels/common/save')}" icon="wf-ui-icon-save" update=":formAbsence :dialogAddAbsence :userAbsentOutput" actionListener="#{logic.addAbsence}" />
 						<p:spacer width="5px" />
 						<p:commandButton id="cancelNewAbsence" value="#{ivy.cms.co('/labels/common/cancel')}" icon="wf-ui-icon-cancel" oncomplete="PF('addAbsence').hide();" process="@this">
							<p:resetInput target="formAddAbsence" />
						</p:commandButton>
					</p:outputPanel>
				</h:panelGrid>
			</h:form>
		</p:dialog>
		
		<p:dialog id="dialogEditAbsence" header="#{ivy.cms.co('/labels/settings/absence/editAbsence')}" widgetVar="editAbsence" modal="true" appendToBody="true" visible="#{data.edit}">
   			<h:form id="formEditAbsence">
				<ui:include src="AbsenceDialog.xhtml" />
				<h:panelGrid style="width:100%; text-align: right;">
					<p:outputPanel>
 						<p:commandButton id="saveEditAbsence" value="#{ivy.cms.co('/labels/common/save')}" icon="wf-ui-icon-save" update=":formAbsence :dialogEditAbsence :userAbsentOutput" actionListener="#{logic.editAbsence}" />
						<p:spacer width="5px" />
						<p:commandButton id="cancelEditAbsence" value="#{ivy.cms.co('/labels/common/cancel')}" icon="wf-ui-icon-cancel" oncomplete="PF('editAbsence').hide();" process="@this">
							<p:resetInput target="formEditAbsence" />
						</p:commandButton>
					</p:outputPanel>
				</h:panelGrid>
			</h:form>
		</p:dialog>
   	</ui:define>
</ui:composition>
</html>