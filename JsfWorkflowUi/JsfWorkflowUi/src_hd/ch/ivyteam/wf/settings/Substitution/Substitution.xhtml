<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"      
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:ic="http://ivyteam.ch/jsf/component"
      xmlns:p="http://primefaces.org/ui"
	  xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:pm="http://primefaces.org/mobile">
 
<ui:composition template="/layouts/Workflow.xhtml">
	<ui:param name="centerHeader" value="#{ivy.cms.co('/navLabels/substitution')}" />
	<ui:define name="center">
		<f:event type="preRenderView" listener="#{logic.update()}" />
		<br />
		<h:outputText value="#{ivy.cms.co('/labels/settings/substitute/titleSubstitutes')}" style="font-weight:bold;" />
		<br />
		#{ivy.cms.co('/labels/settings/substitute/descriptionSubstitutes')}
		<br />
		<br />
		<h:form id="formAddButton">
			<p:commandButton id="addSubstitute" icon="wf-ui-icon-add" update=":dialogAddSubstitute" value="#{ivy.cms.co('/labels/settings/substitute/addSubstitute')}" title="#{ivy.cms.co('/labels/settings/substitute/addSubstituteTooltip')}" oncomplete="PF('addSubstitute').show();" />
		</h:form>
		<br />
		<h:form id="formSubstitute">
			<p:dataTable id="tableSubstitute" value="#{data.substitutes}" var="substitute" emptyMessage="#{ivy.cms.co('/labels/common/noSubstitutions')}">
				<p:column sortBy="#{substitute.substituteUser.fullName}" style="width: 150px;">
   					<f:facet name="header">  
      					#{ivy.cms.co('/labels/settings/substitute/substituteUser')}
   					</f:facet>
   					<h:graphicImage name="images/details/user.png" alt="#{task.activator}" />
   					<h:outputLabel value=" #{substitute.substituteUser.fullName}" />
   					<h:outputLabel value=" #{substitute.substituteUser.name}" rendered="#{substitute.substituteUser.fullName == ''}" />
   					<h:outputLabel value=" (#{substitute.substituteUser.name})" rendered="#{substitute.substituteUser.fullName != ''}" /> 
				</p:column>
				<p:column style="width: 220px;">  
   					<f:facet name="header">  
       					#{ivy.cms.co('/labels/settings/substitute/substituteFor')}
   					</f:facet>
   					<h:graphicImage name="#{substitute.isPersonallyOnly() ? 'images/others/none.png' : 'images/details/role.png'}" />
   					<h:outputLabel value=" #{ivy.cms.co('/labels/settings/substitute/substituteMyTasks')}" rendered="#{substitute.isPersonallyOnly()}" /> 
					<h:outputLabel value=" #{substitute.substitutionRole.displayName} (#{substitute.substitutionRole.name})" rendered="#{!substitute.isPersonallyOnly()}" />
   				</p:column>
				<p:column>  
   					<f:facet name="header">  
       					#{ivy.cms.co('/labels/common/description')}
   					</f:facet>  
   					#{substitute.description}
				</p:column>
				<p:column style="width: 80px; text-align: center;">
   					<f:facet name="header">
       					#{ivy.cms.co('/labels/settings/substitute/substituteControls')}
   					</f:facet>
   					<p:commandButton id="removeButton" actionListener="#{logic.removeSubstitute(substitute.id)}" update=":formSubstitute" icon="wf-ui-icon-delete" value="#{ivy.cms.co('/labels/common/delete')}" ajax="false" />
				</p:column>
			</p:dataTable>
		</h:form>
		<br />
		<p:separator id="customSeparator" style="height:10px" />
		<br />
		<h:outputText value="#{ivy.cms.co('/labels/settings/substitute/titleMySubstitutions')}" style="font-weight:bold;" />
		<br />
		#{ivy.cms.co('/labels/settings/substitute/descriptionMySubstitutions')}
		<br />
		<br />
		<h:form id="formMySubstitutions">
			<p:dataTable id="tableMySubstitutions" value="#{data.substiutions}" var="substitution" emptyMessage="#{ivy.cms.co('/labels/common/nothingToSubstitute')}">
				<p:column sortBy="#{substitution.user.name}">  
   					<f:facet name="header">  
      					#{ivy.cms.co('/labels/settings/substitute/substituteFor')} #{ivy.cms.co('/labels/common/user')}
   					</f:facet>
   					<h:graphicImage name="images/details/user.png" alt="#{task.activator}" />
   					<h:outputLabel value=" #{substitution.user.fullName}" />
   					<h:outputLabel value=" #{substitution.user.name}" rendered="#{substitution.user.fullName == ''}" />
   					<h:outputLabel value=" (#{substitution.user.name})" rendered="#{substitution.user.fullName != ''}" /> 
  				</p:column>
				<p:column>
   					<f:facet name="header">
      					#{ivy.cms.co('/labels/settings/substitute/substituteFor')}
   					</f:facet>
					<h:graphicImage name="#{substitution.isPersonallyOnly() ? 'images/others/none.png' : 'images/details/role.png'}" />
   					<h:outputLabel value=" #{ivy.cms.co('/labels/settings/substitute/substituteUserTasks')}" rendered="#{substitution.isPersonallyOnly()}" /> 
					<h:outputLabel value=" #{substitution.substitutionRole.displayName} (#{substitution.substitutionRole.name})" rendered="#{!substitution.isPersonallyOnly()}" />
  				</p:column>
   				<p:column>
   					<f:facet name="header">
   						#{ivy.cms.co('/labels/settings/substitute/currentState')}
   					</f:facet>
       				#{substitution.user.isAbsent() ? ivy.cms.co('/labels/settings/absence/currentlyAbsent') : ivy.cms.co('/labels/settings/absence/notAbsent')}
   				</p:column>
			</p:dataTable>
		</h:form>
		
		<p:dialog id="dialogAddSubstitute" header="#{ivy.cms.co('/labels/settings/substitute/dialogHeaderAdd')}" widgetVar="addSubstitute" modal="true" appendTo="@(body)">
			<h:form id="formAddSubstitute">
				<ui:include src="SubstitutionDialog.xhtml" />
				<h:panelGrid style="width:100%; text-align: right;">
					<p:outputPanel>
						<p:commandButton id="saveSubstitution" value="#{ivy.cms.co('/labels/common/save')}" icon="wf-ui-icon-save" update=":formSubstitute :dialogAddSubstitute" actionListener="#{logic.addSubstitute}" />
						<p:spacer width="5px" />
						<p:commandButton id="cancelSubstitutionAdd" value="#{ivy.cms.co('/labels/common/cancel')}" icon="wf-ui-icon-cancel" oncomplete="PF('addSubstitute').hide();" process="@this"/>
					</p:outputPanel>
				</h:panelGrid>
			</h:form>
		</p:dialog>
   	</ui:define>
</ui:composition>
</html>