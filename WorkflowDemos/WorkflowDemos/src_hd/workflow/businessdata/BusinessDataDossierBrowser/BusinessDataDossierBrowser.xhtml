<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile">
<h:body>
	<ui:composition template="/layouts/basic.xhtml">
		<ui:define name="title">BusinessDataDossierBrowser</ui:define>
		<ui:define name="content">
			<style type="text/css">
				.ui-panelgrid,
				.ui-panelgrid .ui-panelgrid-cell {border: none;}
			</style>
		
		    <h:outputStylesheet ></h:outputStylesheet>
			<h3>Browse Dossiers</h3>

	        <h:form>
				<p:panelGrid columns="2">
				  <p:selectOneRadio id="search" value="#{data.searchType}" >
				    <f:selectItem itemLabel="Full Text" itemValue="FullText"/>
				    <f:selectItem itemLabel="Last Name" itemValue="LastName"/>
				    <f:selectItem itemLabel="Birth Date" itemValue="BirthDate"/>
				    <p:ajax update="searchBox"/>
				  </p:selectOneRadio>
				  <br/>
				  <p:outputPanel id="searchBox">
					<p:inputText value="#{data.searchText}" placeholder="Ask me anything" size="40" rendered="#{data.searchType=='FullText' || data.searchType=='LastName'}"/>
					<p:panelGrid columns="4" id="DateRange" rendered="#{data.searchType=='BirthDate'}">
						<p:outputLabel value="From:" for="fromDate"/>
						<p:calendar id="fromDate" value="#{data.searchFromDate}" navigator="true" yearRange="c-50:c+10" pattern="dd.MM.yyyy">
     						<p:ajax event="dateSelect" listener="#{logic.updateSearchToDate}" update="toDate" />
     						<f:convertDateTime pattern="dd.MM.yyyy" />
		  				</p:calendar>
						<p:outputLabel value="To:" for="toDate"/>
						<p:calendar id="toDate" value="#{data.searchToDate}"  mindate="#{data.searchFromDate.toJavaDate()}" navigator="true" yearRange="c-50:c+10" pattern="dd.MM.yyyy">
		           			<f:convertDateTime pattern="dd.MM.yyyy" />
		 				</p:calendar>
					</p:panelGrid>
				 </p:outputPanel>				  
				 <p:commandButton value="Search" actionListener="#{logic.search}" update=":dossierTable" />
				</p:panelGrid>
		  	</h:form>

			<p:dataTable var="dossier" value="#{data.dossiers}" rowIndexVar="rowIndex" id="dossierTable">

				<p:column headerText="Dossier Name">
					<h:outputText value="#{dossier.name}" />
				</p:column>
				<p:column headerText="Person">
					<h:outputText value="#{dossier.person.firstName} " />
					<h:outputText value="#{dossier.person.lastName}" />
					<br />
					* <h:outputText value="#{dossier.person.birthDate}">
  						<f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
					</h:outputText>
				</p:column>
				<p:column headerText="Address">
					<h:outputText value="#{dossier.person.address.zip} " />
					<h:outputText value="#{dossier.person.address.city}" />
					<br />
					<h:outputText value="#{dossier.person.address.country}" />
				</p:column>
				<p:column headerText="Operations">
					<p:link value="update"
						href="#{ivy.html.startref('155BB4328F79B2D5/update.ivp')}?id=#{ivy.repo.getId(dossier)} " />
					<br />
					<p:link value="delete"
						href="#{ivy.html.startref('155BB4328F79B2D5/delete.ivp')}?id=#{ivy.repo.getId(dossier)} " />
					<br />
					<p:link value="start person verification"
						href="#{ivy.html.startref('155BB4328F79B2D5/verifyDossier.ivp')}?id=#{ivy.repo.getId(dossier)} " />
				</p:column>

			</p:dataTable>
			
            <p:growl showDetail="true" id="infoGrowl" escape="false" sticky="true"/>
           	<f:event type="preRenderView" listener="#{logic.displayMessage}" />

			<div align="left" style="float:left">
				<p:link value="+ Create new Dossier"
				href="#{ivy.html.startref('155BB4328F79B2D5/create.ivp')}" />
				<br />
			</div>

			<div align="right">
				<p:link value="Show all dossiers"
					href="#{ivy.html.startref('155BB4328F79B2D5/browse.ivp')}" />
				<br />
			</div>

		</ui:define>
	</ui:composition>
</h:body>
</html>